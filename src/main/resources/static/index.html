<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>基本数据表格 - jQuery EasyUI 示例</title>
    <link rel="stylesheet" type="text/css" href="themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="themes/icon.css">
    <link rel="stylesheet" type="text/css" href="demo/demo.css">
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.easyui.min.js"></script>
    <script type="text/javascript" src="locale/easyui-lang-zh_CN.js"></script>
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #tb {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<table id="tb"></table>

<script>
    $(function () {
        // 存储分页数据的全局变量
        var paginationData = {
            pageNo: 1,
            pageSize: 10
        };

        // 页面加载完成后，创建数据表格 datagrid
        $("#tb").datagrid({
            fit: true,
            columns: [[
                {title: '编号', field: 'id', checkbox: true},
                {title: '姓名', field: 'name'},
                {title: '姓名全拼', field: 'nameSpelling'},
                {title: '性别', field: 'gender'},
                {title: '身份证件类型', field: 'identityCardType'},
                {title: '身份证件号码', field: 'identityCardNumber'},
                {title: '出生日期', field: 'birthday'},
                {title: '手机号码', field: 'phone'},
                {title: '电子邮箱', field: 'email'}
            ]],
            rownumbers: true,
            singleSelect: false, // 允许多选
            toolbar: [
                {
                    text: '添加', iconCls: 'icon-add', handler: function () {
                        alert('添加...');
                    }
                },
                {
                    text: '删除', iconCls: 'icon-remove', handler: function () {
                        var rows = $('#tb').datagrid('getSelections');
                        if (rows.length === 0) {
                            alert('请选择要删除的数据！');
                            return;
                        }

                        var ids = [];
                        for (var i = 0; i < rows.length; i++) {
                            ids.push(rows[i].id);
                        }

                        $.ajax({
                            url: 'http://localhost/api/personalInformation/delete',
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify({ ids: ids }),
                            success: function (response) {
                                if (response.code === 200) {
                                    alert('删除成功！');
                                    loadData();
                                } else {
                                    console.log('删除失败:', response.message);
                                }
                            },
                            error: function (xhr, status, error) {
                                console.log('错误:', error);
                            }
                        });
                    }
                },
                {
                    text: '修改', iconCls: 'icon-edit', handler: function () {
                        alert('修改...');
                    }
                },
                {
                    text: '导入', iconCls: 'icon-back', handler: function () {
                        alert('导入Excel...');
                    }
                },
                {
                    text: '导出Excel', iconCls: 'icon-save', handler: function () {
                        exportExcel();
                    }
                }
            ],
            pagination: true,
            pageList: [10, 20, 30, 50],
            onLoadSuccess: function () {
                // 绑定分页工具栏的翻页事件
                $('#tb').datagrid('getPager').pagination({
                    onSelectPage: function (pageNo, pageSize) {
                        paginationData.pageNo = pageNo;
                        paginationData.pageSize = pageSize;
                        loadData();
                    }
                });
            }
        });

        // 加载数据
        loadData();

        // 获取数据并加载到表格中
        function loadData() {
            $.ajax({
                url: 'http://localhost/api/personalInformation/getMessage',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(paginationData),
                success: function (response) {
                    if (response.code === 200) {
                        var items = response.data.items;
                        $('#tb').datagrid('loadData', items);
                        // 更新分页工具栏的总记录数和当前页码
                        $('#tb').datagrid('getPager').pagination('refresh', {
                            total: response.data.total,
                            pageNumber: paginationData.pageNo
                        });
                    } else {
                        console.log('加载数据失败:', response.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.log('错误:', error);
                }
            });
        }

        // 导出Excel
        function exportExcel() {
            window.location.href = 'http://localhost:80/api/personalInformation/export';
        }
    });
</script>
</body>
</html>
